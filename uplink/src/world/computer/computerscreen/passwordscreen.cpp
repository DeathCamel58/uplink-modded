// PasswordScreen.cpp: implementation of the PasswordScreen class.
//
//////////////////////////////////////////////////////////////////////

#include <cstring>
#include <cstdio>
#include <app/miscutils.h>

#include "gucci.h"

#include "game/game.h"

#include "app/app.h"
#include "app/globals.h"
#include "app/serialise.h"

#include "world/computer/computerscreen/passwordscreen.h"

#include "mmgr.h"


PasswordScreen::PasswordScreen()
{

	nextpage = -1;
	difficulty = 1;
	memset( password, 0, sizeof ( password ) );

}

PasswordScreen::~PasswordScreen()
= default;

void PasswordScreen::SetNextPage ( int newnextpage )
{

	nextpage = newnextpage;

}

void PasswordScreen::SetPassword ( char *newpassword )
{

	UplinkAssert ( strlen (newpassword) < SIZE_PASSWORDSCREEN_PASSWORD )
	UplinkStrncpy ( password, newpassword, sizeof ( password ) )

}

void PasswordScreen::SetDifficulty ( int newdifficulty )
{

	difficulty = newdifficulty;

}

bool PasswordScreen::Load  ( FILE *file )
{

	LoadID ( file );

	if ( !ComputerScreen::Load ( file ) ) return false;

	if ( !FileReadData ( &nextpage, sizeof(nextpage), 1, file ) ) return false;

	if ( strcmp( game->GetLoadedSavefileVer(), "SAV59" ) >= 0 ) {
		if ( !LoadDynamicStringStatic ( password, sizeof(password), file ) ) return false;
	}
	else {
		if ( !FileReadData ( password, sizeof(password), 1, file ) ) {
			password [ sizeof(password) - 1 ] = '\0';
			return false;
		}
		password [ sizeof(password) - 1 ] = '\0';
	}

	if ( !FileReadData ( &difficulty, sizeof(difficulty), 1, file ) ) return false;

	LoadID_END ( file );

	return true;

}

void PasswordScreen::Save  ( FILE *file )
{

	SaveID ( file );

	ComputerScreen::Save ( file );

	fwrite ( &nextpage, sizeof(nextpage), 1, file );
	SaveDynamicString ( password, sizeof(password), file );
	fwrite ( &difficulty, sizeof(difficulty), 1, file );

	SaveID_END ( file );

}

void PasswordScreen::Print ()
{

    cout << "PasswordScreen : " << endl;
	ComputerScreen::Print ();
    PrintValue("NextPage", nextpage);
    PrintValue("Password", password);
    PrintValue("Difficulty", difficulty);

}
	
string PasswordScreen::GetID ()
{

	return "SCR_PASS";

}

int PasswordScreen::GetOBJECTID ()
{

	return OID_PASSWORDSCREEN;

}

